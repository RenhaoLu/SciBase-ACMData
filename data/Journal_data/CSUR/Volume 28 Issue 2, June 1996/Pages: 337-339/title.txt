Compiling functional languages with flow analysis